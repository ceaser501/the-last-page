<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Last Page - Intro</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Homemade+Apple&family=Dancing+Script:wght@400;700&family=Pacifico&family=Satisfy&family=Playfair+Display:wght@400;700;900&family=Noto+Serif+KR:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="stylesheet" href="mobile-responsive.css" />
    <style>
      :root {
        --bg-color: #fafaee;
        --text-color: #4a4a4a;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        width: 100vw;
        height: 100vh;
        background-color: var(--bg-color);
        background-image: url("data/background.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
      }

      /* ë°°ê²½ ì˜¤ë²„ë ˆì´ (index.htmlê³¼ ë™ì¼) */
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(250, 250, 238, 0.3);
        pointer-events: none;
      }

      .intro-container {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0;
        z-index: 1;
        max-width: 90vw;
        max-height: 80vh;
      }

      .card-container {
        display: flex;
        background: white;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      }

      .image-wrapper {
        position: relative;
        width: 400px;
        height: 600px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-color);
      }

      .text-section {
        width: 400px;
        height: 600px;
        background: repeating-linear-gradient(
            45deg,
            #fefefe,
            #fefefe 1px,
            #fcfcfc 1px,
            #fcfcfc 2px
          ),
          linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 40px;
        box-sizing: border-box;
        position: relative;
        box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.02),
          inset 0 0 10px rgba(0, 0, 0, 0.01);
      }

      /* ì¢…ì´ ì§ˆê° íš¨ê³¼ - ë¯¸ì„¸í•œ ì„¬ìœ ì§ˆ íŒ¨í„´ */
      .text-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
            0deg,
            transparent,
            transparent 3px,
            rgba(0, 0, 0, 0.01) 3px,
            rgba(0, 0, 0, 0.01) 4px
          ),
          repeating-linear-gradient(
            90deg,
            transparent,
            transparent 3px,
            rgba(0, 0, 0, 0.01) 3px,
            rgba(0, 0, 0, 0.01) 4px
          );
        opacity: 0.4;
        pointer-events: none;
      }

      /* ê³ ê¸‰ ì¢…ì´ ëŠë‚Œì˜ ë¯¸ì„¸í•œ ë…¸ì´ì¦ˆ */
      .text-section::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.015;
        background-image: repeating-conic-gradient(
          #ffffff 0%,
          #f5f5f5 25%,
          #ffffff 50%,
          #f5f5f5 75%,
          #ffffff 100%
        );
        background-size: 100px 100px;
        mix-blend-mode: multiply;
        pointer-events: none;
      }

      .graffiti-heart-left {
        opacity: 1;
        transform: rotate(-20deg) scale(1.1);
        color: #ff5722;
      }

      /* í…ìŠ¤íŠ¸ ì„¹ì…˜ ì œëª© */
      .section-title {
        font-family: "Playfair Display", serif;
        font-size: 32px;
        font-weight: 900;
        color: #2a2a2a;
        letter-spacing: 4px;
        text-transform: uppercase;
        margin-bottom: 40px;
        z-index: 1;
      }

      /* í…ìŠ¤íŠ¸ ì„¹ì…˜ ë‚´ìš© */
      .section-content {
        font-family: "Noto Serif KR", serif;
        font-size: 16px;
        font-weight: 300;
        color: #4a4a4a;
        line-height: 2;
        text-align: center;
        z-index: 1;
      }

      /* ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸ */
      .story-text {
        font-family: "Noto Serif KR", serif;
        font-size: 14px;
        font-weight: 300;
        color: #5a5a5a;
        line-height: 1.8;
        text-align: center;
        margin-top: 30px;
        z-index: 1;
      }

      /* ë§ˆì§€ë§‰ ì§ˆë¬¸ */
      .final-question {
        font-family: "Playfair Display", serif;
        font-size: 32px;
        font-weight: 900;
        color: #2a2a2a;
        letter-spacing: 2px;
        margin-top: 20px;
        z-index: 1;
      }

      /* ìŒí‘œ ì•„ì´ì½˜ - í¬ê¸° ì¡°ì • */
      #intro-music-icon {
        position: fixed;
        top: 20px;
        left: 20px;
        width: 38px;
        height: 38px;
        background: white;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        color: #333;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      #intro-music-icon:hover {
        background: #f0f0f0;
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      /* ë©”ì¸ ìŒì•… í”Œë ˆì´ì–´ ìŠ¤íƒ€ì¼ (intro.html ì „ìš©) - í¬ê¸° ì¡°ì • */
      .intro-music-wrapper {
        position: fixed;
        left: 65px;
        top: 20px;
        z-index: 999;
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .intro-music-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        width: 300px;
        backdrop-filter: blur(10px);
      }

      .intro-music-player {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .intro-album-art {
        width: 50px;
        height: 50px;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      .intro-album-art img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .intro-track-info {
        flex: 1;
      }

      .intro-track-name {
        font-size: 13px;
        font-weight: 600;
        color: #333;
        margin-bottom: 3px;
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .intro-artist-name {
        font-size: 11px;
        color: #666;
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .intro-controls {
        display: flex;
        gap: 6px;
      }

      .intro-control-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #f88;
        color: white;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 12px;
      }

      .intro-control-btn:hover {
        transform: scale(1.1);
        background: #f66;
      }

      .intro-seek-bar-container {
        width: 100%;
        height: 3px;
        background: #eee;
        border-radius: 2px;
        margin-top: 8px;
        position: relative;
        cursor: pointer;
      }

      .intro-seek-bar {
        height: 100%;
        background: #f88;
        border-radius: 2px;
        width: 0%;
        transition: width 0.1s linear;
      }

      /* Wedding D-Day ì¹´ìš´í„° ìŠ¤íƒ€ì¼ */
      .wedding-dday-container {
        margin-top: 30px;
        z-index: 1;
      }

      .dday-title {
        font-family: "Noto Serif KR", serif;
        font-size: 12px;
        font-weight: 300;
        color: #999;
        text-align: center;
        margin-bottom: 10px;
      }

      .dday-counter {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .dday-item {
        text-align: center;
      }

      .dday-number {
        font-family: "Playfair Display", serif;
        font-size: 24px;
        font-weight: 700;
        color: #f88;
        display: block;
      }

      .dday-unit {
        font-family: "Noto Serif KR", serif;
        font-size: 10px;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 2px;
        display: block;
      }

      /* í•„ê¸°ì²´ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
      .love-text {
        position: absolute;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%) rotate(-5deg);
        z-index: 3;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .love-line {
        font-family: "Dancing Script", cursive;
        font-size: 36px;
        font-weight: 700;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        white-space: nowrap;
        letter-spacing: 2px;
      }

      .date-line {
        font-family: "Dancing Script", cursive;
        font-size: 28px;
        font-weight: 400;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        white-space: nowrap;
        letter-spacing: 1px;
      }

      .love-text span {
        display: inline-block;
        opacity: 0;
        animation: typeWriter 0.3s forwards;
        animation-delay: calc(var(--index) * 0.1s);
      }

      @keyframes typeWriter {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .intro-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      /* ì–‡ì€ í°ìƒ‰ í…Œë‘ë¦¬ */
      .image-border {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        bottom: 20px;
        border: 2px solid rgba(255, 255, 255, 0.9);
        pointer-events: none;
        z-index: 2;
      }

      /* ë²šê½ƒ ì• ë‹ˆë©”ì´ì…˜ */
      .sakura-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
        z-index: 10;
      }

      .sakura-petal {
        position: absolute;
        background: radial-gradient(
          circle,
          rgba(255, 192, 203, 0.8) 0%,
          rgba(255, 182, 193, 0.6) 100%
        );
        border-radius: 150% 0 150% 0;
        pointer-events: none;
        animation: sakuraFall linear infinite;
      }

      .sakura-petal::after {
        content: "";
        position: absolute;
        top: -14%;
        left: -10%;
        display: block;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          rgba(255, 192, 203, 0.8) 0%,
          rgba(255, 182, 193, 0.6) 100%
        );
        border-radius: 150% 0 150% 0;
        transform: rotate(15deg);
      }

      @keyframes sakuraFall {
        0% {
          top: -10%;
          transform: translateX(0) rotateZ(0deg);
          opacity: 1;
        }
        25% {
          transform: translateX(-20px) rotateZ(90deg);
        }
        50% {
          transform: translateX(20px) rotateZ(180deg);
        }
        75% {
          transform: translateX(-20px) rotateZ(270deg);
        }
        100% {
          top: 110%;
          transform: translateX(30px) rotateZ(360deg);
          opacity: 0;
        }
      }

      .button-container {
        display: flex;
        gap: 60px;
        margin-top: 40px;
        position: absolute;
        bottom: -100px;
        left: 50%;
        transform: translateX(-50%);
      }

      .intro-button {
        padding: 10px 30px;
        font-size: 14px;
        font-family: "Noto Serif KR", serif;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        border-radius: 25px;
        text-decoration: none;
        display: inline-block;
        border: 1px solid;
      }

      .intro-button.yes {
        background: #ffe2e3;
        color: #333;
        border-color: #ffb8ba;
      }

      .intro-button.yes:hover {
        background: #f88;
        color: white;
        border-color: #f88;
        transform: translateY(-2px) scale(1.1);
        box-shadow: 0 4px 15px rgba(248, 136, 136, 0.3);
      }

      .intro-button.no {
        background: #f0f0f0;
        color: #666;
        border-color: #ccc;
      }

      .intro-button.no:hover {
        background: #999;
        color: white;
        border-color: #999;
        transform: translateY(-2px) scale(1.1);
        box-shadow: 0 4px 15px rgba(153, 153, 153, 0.3);
      }

      /* ì»¤ìŠ¤í…€ ì•Œë¦¼ ë©”ì‹œì§€ */
      .custom-alert {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        text-align: center;
        opacity: 0;
        transition: all 0.3s ease;
        max-width: 400px;
      }

      .custom-alert.show {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }

      .custom-alert-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        display: none;
        transition: opacity 0.3s ease;
      }

      .custom-alert-overlay.show {
        display: block;
        opacity: 1;
      }

      .custom-alert-message {
        font-family: "Noto Serif KR", serif;
        font-size: 14px;
        font-weight: 300;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.8;
      }

      .custom-alert-button {
        background: #f88;
        color: white;
        border: none;
        padding: 10px 30px;
        border-radius: 20px;
        font-family: "Noto Serif KR", serif;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .custom-alert-button:hover {
        background: #e77;
        transform: scale(1.05);
      }

      /* ëª¨ë°”ì¼ ëŒ€ì‘ */
      @media (max-width: 768px) {
        .card-container {
          flex-direction: column;
          max-width: 90vw;
        }

        .image-wrapper,
        .text-section {
          width: 90vw;
          height: 45vh;
        }

        .button-container {
          gap: 30px;
          position: relative;
          bottom: auto;
          margin-top: 20px;
        }

        .intro-button {
          padding: 8px 25px;
          font-size: 13px;
        }
        .graffiti-heart-left {
          opacity: 1;
          transform: rotate(-20deg) scale(1.1);
          color: #ff5722;
        }
      }
    </style>
  </head>
  <body>
    <!-- ìŒí‘œ ì•„ì´ì½˜ -->
    <button id="intro-music-icon" title="ë°°ê²½ìŒì•…">
      <i class="fas fa-music"></i>
    </button>

    <!-- ìŒì•… í”Œë ˆì´ì–´ -->
    <div id="intro-music-player" class="intro-music-wrapper">
      <div class="intro-music-container">
        <div class="intro-music-player">
          <div class="intro-album-art">
            <img id="intro-album-img" src="" alt="Album Art" />
          </div>
          <div class="intro-track-info">
            <span class="intro-track-name" id="intro-track-name"
              >Loading...</span
            >
            <span class="intro-artist-name" id="intro-artist-name"
              >Loading...</span
            >
            <div class="intro-seek-bar-container">
              <div class="intro-seek-bar" id="intro-seek-bar"></div>
            </div>
          </div>
          <div class="intro-controls">
            <button class="intro-control-btn" id="intro-prev-btn">
              <i class="fas fa-backward"></i>
            </button>
            <button class="intro-control-btn" id="intro-play-btn">
              <i class="fas fa-play"></i>
            </button>
            <button class="intro-control-btn" id="intro-next-btn">
              <i class="fas fa-forward"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="sakura-container" id="sakuraContainer"></div>
    <div class="intro-container">
      <div class="card-container">
        <div class="image-wrapper">
          <img src="data/intro1.jpeg" alt="Intro" class="intro-image" />
          <div class="image-border"></div>
          <div class="love-text" id="loveText"></div>
        </div>
        <div class="text-section">
          <div class="section-title">PROMISE</div>
          <div class="section-content">
            ë‚˜ì˜ ì˜¤ëŠ˜ ê·¸ë¦¬ê³  ëª¨ë“  ë‚´ì¼ì„,<br />
            ìš°ë¦¬ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í•¨ê»˜ í•´ ì£¼ê¸¸ ì›í•´
          </div>
          <!-- ìš°ë¦¬ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í•¨ê»˜ í•´ì£¼ì—ˆìœ¼ë©´ í•´ -->
          <div class="story-text">
            2024ë…„ 9ì›” 21ì¼ ì†Œê°œíŒ… ë‚ ,<br />
            ë³´ì—°ì´ê°€ ë¬¸ì„ ì—´ê³  ë“¤ì–´ì˜¤ëŠ” ìˆœê°„ ëŠê¼ˆì–´<br />
            "ì–´ì©Œë©´ ë‚´ê°€ ì°¾ë˜ ë§ˆì§€ë§‰ ì¸ì—°ì´<br />
            ì´ ì‚¬ëŒì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤"<br /><br />
            ê·¸ë‚ ë¶€í„° ì˜¤ëŠ˜ ì´ ìˆœê°„ê¹Œì§€,<br />
            ì˜¨ ì§„ì‹¬ì„ ë‹¤í•´ ì‚¬ë‘í•˜ê³  ê¸°ë‹¤ë ¤ì™”ì–´<br />
            ê·¸ë¦¬ê³  ë“œë””ì–´ ì˜¤ëŠ˜ <br />ê·¸ ë‹µì„ êµ¬í•˜ë ¤ í•´<br /><br />
            <span style="font-weight: bold">ë³´ì—°ì•„, ë‚˜ë‘ ê²°í˜¼ í•´ ì¤„ë˜</span>
            <span class="graffiti-heart-left">â™¥</span>
          </div>
          <div class="wedding-dday-container">
            <div class="dday-title">ìš°ë¦¬ì˜ ìƒˆë¡œìš´ ì‹œì‘ê¹Œì§€</div>
            <div class="dday-counter">
              <div class="dday-item">
                <span class="dday-number" id="days">000</span>
                <span class="dday-unit">Days</span>
              </div>
              <div class="dday-item">
                <span class="dday-number" id="hours">00</span>
                <span class="dday-unit">Hours</span>
              </div>
              <div class="dday-item">
                <span class="dday-number" id="minutes">00</span>
                <span class="dday-unit">Minutes</span>
              </div>
              <div class="dday-item">
                <span class="dday-number" id="seconds">00</span>
                <span class="dday-unit">Seconds</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="button-container">
        <button class="intro-button yes" onclick="handleYes()">YES!</button>
        <button class="intro-button no" onclick="handleNo()">NO</button>
      </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ì•Œë¦¼ ì˜¤ë²„ë ˆì´ -->
    <div class="custom-alert-overlay" id="alertOverlay"></div>
    <div class="custom-alert" id="customAlert">
      <div class="custom-alert-message" id="alertMessage"></div>
      <button class="custom-alert-button" onclick="closeAlert()">í™•ì¸</button>
    </div>

    <!-- ìŒì•… í”Œë ˆì´ì–´ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://lbjqzhqqxuqyvglslpne.supabase.co/storage/v1/object/public/public-config//config.js"></script>

    <script src="wedding-dday.js"></script>
    <script>
      // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
      window.supabaseClient = supabase.createClient(
        window.SUPABASE_CONFIG.url,
        window.SUPABASE_CONFIG.anonKey
      );
    </script>
    <script>
      let isYesClicked = false;

      function showCustomAlert(message, callback) {
        const overlay = document.getElementById("alertOverlay");
        const alertBox = document.getElementById("customAlert");
        const messageEl = document.getElementById("alertMessage");

        messageEl.innerHTML = message;
        overlay.classList.add("show");
        alertBox.classList.add("show");

        if (callback) {
          window.alertCallback = callback;
        }
      }

      function closeAlert() {
        const overlay = document.getElementById("alertOverlay");
        const alertBox = document.getElementById("customAlert");

        overlay.classList.remove("show");
        alertBox.classList.remove("show");

        if (window.alertCallback) {
          window.alertCallback();
          window.alertCallback = null;
        }
      }

      function handleYes() {
        if (isYesClicked) return;
        isYesClicked = true;

        showCustomAlert(
          "ê³ ë§ˆì›Œìš”ğŸ˜ í‰ìƒ ë‚´ê°€ ë” ì˜í• ê²Œ! <br> í•¨ê»˜ ë³´ë‚¸ ì´ ì‹œê°„ë“¤ì²˜ëŸ¼ ë¶„ëª… í–‰ë³µ í• ê±°ì•¼",
          function () {
            // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í‘œì‹œ - main.htmlì—ì„œ ìë™ì¬ìƒ ê°€ëŠ¥í•˜ë„ë¡
            sessionStorage.setItem("userInteracted", "true");
            sessionStorage.setItem("fromIndex", "true");
            window.location.href = "main.html";
          }
        );
      }

      function handleNo() {
        showCustomAlert(
          "ê±°ì ˆì€ ê±°ì ˆí•œë‹¤ğŸ¤« <br> ì–´ë”œ~~ ì˜¤ë¹¤ë°? NOë¥¼ ëˆ„ë¥´ê³  ìˆì–´~"
        );
      }

      // íƒ€ì´í•‘ íš¨ê³¼ í…ìŠ¤íŠ¸
      window.addEventListener("DOMContentLoaded", function () {
        const text = "Will you marry me?";
        const loveTextElement = document.getElementById("loveText");

        // Will you marry me? í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜
        function animateText() {
          loveTextElement.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°

          const loveLine = document.createElement("div");
          loveLine.className = "love-line";

          text.split("").forEach((char, index) => {
            const span = document.createElement("span");
            span.textContent = char === " " ? "\u00A0" : char;
            span.style.setProperty("--index", index);
            span.style.opacity = "0";
            span.style.animation = "typeWriter 0.3s forwards";
            span.style.animationDelay = `${index * 0.1}s`;

            // ë’¤ë¡œ ê°ˆìˆ˜ë¡ ì•½ê°„ì”© ìœ„ë¡œ ì˜¬ë¦¬ê¸°
            const upOffset = (index / text.length) * 3; // ìµœëŒ€ 3pxê¹Œì§€ ì˜¬ë¼ê°
            span.style.transform = `translateY(-${upOffset}px)`;

            loveLine.appendChild(span);
          });

          loveTextElement.appendChild(loveLine);

          // ëª¨ë“  ê¸€ìê°€ ë‚˜íƒ€ë‚œ í›„ 2ì´ˆ ëŒ€ê¸° í›„ ì‚¬ë¼ì§€ê³  ë‹¤ì‹œ ì‹œì‘
          setTimeout(() => {
            loveLine.style.animation = "fadeOut 1s forwards";
            setTimeout(() => {
              animateText(); // ì¬ê·€ì ìœ¼ë¡œ ë‹¤ì‹œ í˜¸ì¶œ
            }, 1500); // ì‚¬ë¼ì§„ í›„ 0.5ì´ˆ ëŒ€ê¸°
          }, text.length * 100 + 2000); // ëª¨ë“  ê¸€ì í‘œì‹œ + 2ì´ˆ ëŒ€ê¸°
        }

        // ì´ˆê¸° ì‹¤í–‰
        animateText();

        // Wedding D-Day ì¹´ìš´í„°
        const WEDDING_DATE = new Date("2026-04-12T00:00:00").getTime();

        function updateDDayCounter() {
          const now = new Date().getTime();
          const distance = WEDDING_DATE - now;

          if (distance < 0) {
            document.querySelector(".dday-counter").innerHTML = `
              <div class="dday-item">
                <span class="dday-number">â¤ï¸</span>
                <span class="dday-unit">Forever</span>
              </div>
            `;
            return;
          }

          const days = Math.floor(distance / (1000 * 60 * 60 * 24));
          const hours = Math.floor(
            (distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
          );
          const minutes = Math.floor(
            (distance % (1000 * 60 * 60)) / (1000 * 60)
          );
          const seconds = Math.floor((distance % (1000 * 60)) / 1000);

          const formatNumber = (num) => num.toString().padStart(2, "0");
          const formatDays = (num) => num.toString().padStart(3, "0");

          document.getElementById("days").textContent = formatDays(days);
          document.getElementById("hours").textContent = formatNumber(hours);
          document.getElementById("minutes").textContent =
            formatNumber(minutes);
          document.getElementById("seconds").textContent =
            formatNumber(seconds);
        }

        updateDDayCounter();
        setInterval(updateDDayCounter, 1000);

        // ë²šê½ƒ ê½ƒì ìƒì„±
        const sakuraContainer = document.getElementById("sakuraContainer");

        function createSakuraPetal() {
          const petal = document.createElement("div");
          petal.className = "sakura-petal";

          // ëœë¤ í¬ê¸°
          const size = Math.random() * 15 + 10;
          petal.style.width = size + "px";
          petal.style.height = size + "px";

          // ëœë¤ ì‹œì‘ ìœ„ì¹˜ (í™”ë©´ ì „ì²´ ìƒë‹¨ì—ì„œ ì‹œì‘)
          petal.style.left = Math.random() * 100 + "%";

          // ëœë¤ ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„
          petal.style.animationDuration = Math.random() * 10 + 10 + "s";

          // ëœë¤ ì• ë‹ˆë©”ì´ì…˜ ì§€ì—°
          petal.style.animationDelay = Math.random() * 5 + "s";

          // íˆ¬ëª…ë„ ì„¤ì •
          petal.style.opacity = Math.random() * 0.5 + 0.3;

          sakuraContainer.appendChild(petal);

          // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ì œê±°
          setTimeout(() => {
            petal.remove();
          }, 20000);
        }

        // ì´ˆê¸° ê½ƒì ìƒì„±
        for (let i = 0; i < 20; i++) {
          setTimeout(createSakuraPetal, i * 150);
        }

        // ëª¨ë°”ì¼ì—ì„œëŠ” ê°„ê²©ì„ ëŠ˜ë ¤ì„œ ìì—°ìŠ¤ëŸ½ê²Œ
        const sakuraInterval = window.innerWidth <= 768 ? 2500 : 1000;
        setInterval(createSakuraPetal, sakuraInterval);

        // ì´ˆê¸° ê½ƒìë“¤ì„ ì‹œê°„ì°¨ë¥¼ ë‘ê³  ìƒì„±
        if (window.innerWidth <= 768) {
          for (let i = 0; i < 5; i++) {
            setTimeout(createSakuraPetal, i * 500);
          }
        }

        // ìŒì•… í”Œë ˆì´ì–´ ì½”ë“œ
        let introAudio = null;
        let introPlaylist = [];
        let introCurrentTrackIndex = 0;
        let isIntroPlayerVisible = false;

        // ê¸°ë³¸ ì•¨ë²” ì»¤ë²„ URL
        const { data: defaultCoverData } = window.supabaseClient.storage
          .from("media")
          .getPublicUrl("album/default-cover.jpg");
        const DEFAULT_ALBUM_COVER_URL = defaultCoverData.publicUrl;

        // ìŒì•… í”Œë ˆì´ì–´ ì´ˆê¸°í™”
        async function initIntroMusicPlayer() {
          introAudio = new Audio();
          introAudio.volume = 0.7;

          // ìŒì•… ë°ì´í„° ë¡œë“œ
          await loadIntroMusic();

          // ëª¨ë°”ì¼ì—ì„œ ì²« í„°ì¹˜/í´ë¦­ ì‹œ ìë™ì¬ìƒ
          const startIntroMusic = () => {
            if (introAudio.paused && introAudio.src) {
              introAudio
                .play()
                .then(() => {
                  console.log("ğŸµ Intro ìŒì•… ìë™ì¬ìƒ ì‹œì‘");
                  document.getElementById("intro-play-btn").innerHTML =
                    '<i class="fas fa-pause"></i>';
                })
                .catch(console.log);
            }
          };

          // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì´ë²¤íŠ¸ ë“±ë¡
          ["click", "touchstart"].forEach((event) => {
            document.addEventListener(event, startIntroMusic, { once: true });
          });

          // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
          document
            .getElementById("intro-play-btn")
            .addEventListener("click", togglePlay);
          document
            .getElementById("intro-prev-btn")
            .addEventListener("click", playPrevTrack);
          document
            .getElementById("intro-next-btn")
            .addEventListener("click", playNextTrack);

          // ì‹œí¬ë°” ì—…ë°ì´íŠ¸
          introAudio.addEventListener("timeupdate", updateSeekBar);

          // ê³¡ì´ ëë‚¬ì„ ë•Œ ì²˜ë¦¬ (1ê³¡ì¼ ë•ŒëŠ” loopê°€ ìë™ ì²˜ë¦¬)
          introAudio.addEventListener("ended", function () {
            if (introPlaylist.length > 1) {
              playNextTrack();
            }
          });

          // ìŒí‘œ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸
          const musicIcon = document.getElementById("intro-music-icon");
          const musicPlayer = document.getElementById("intro-music-player");

          musicIcon.addEventListener("click", function (e) {
            e.stopPropagation();

            // ëª¨ë°”ì¼ ì²´í¬
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
              // ëª¨ë°”ì¼: í”Œë ˆì´ì–´ í‘œì‹œ ì—†ì´ ìŒì•…ë§Œ ì¬ìƒ/ì •ì§€
              if (introAudio && introAudio.src) {
                if (introAudio.paused) {
                  introAudio
                    .play()
                    .then(() => {
                      document.getElementById("intro-play-btn").innerHTML =
                        '<i class="fas fa-pause"></i>';
                      // ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½ìœ¼ë¡œ ì¬ìƒ ìƒíƒœ í‘œì‹œ
                      musicIcon.querySelector("i").style.color = "#ff8fa3";
                      console.log("ğŸµ ëª¨ë°”ì¼ intro ìŒì•… ì¬ìƒ");
                    })
                    .catch(console.log);
                } else {
                  introAudio.pause();
                  document.getElementById("intro-play-btn").innerHTML =
                    '<i class="fas fa-play"></i>';
                  // ì•„ì´ì½˜ ìƒ‰ìƒ ì›ë˜ëŒ€ë¡œ
                  musicIcon.querySelector("i").style.color = "";
                  console.log("â¸ï¸ ëª¨ë°”ì¼ intro ìŒì•… ì •ì§€");
                }
              }
            } else {
              // PC: ê¸°ì¡´ëŒ€ë¡œ í”Œë ˆì´ì–´ í‘œì‹œ/ìˆ¨ê¹€
              isIntroPlayerVisible = !isIntroPlayerVisible;

              if (isIntroPlayerVisible) {
                musicPlayer.style.opacity = "1";
                musicPlayer.style.transform = "translateX(0)";
                musicPlayer.style.pointerEvents = "auto";

                // ì²˜ìŒ ì—´ ë•Œ ìë™ ì¬ìƒ ì‹œë„
                if (introAudio.paused && introAudio.src) {
                  introAudio.play().catch(console.log);
                }
              } else {
                musicPlayer.style.opacity = "0";
                musicPlayer.style.transform = "translateX(-20px)";
                musicPlayer.style.pointerEvents = "none";
              }
            }
          });

          // í˜¸ë²„ ì´ë²¤íŠ¸
          musicIcon.addEventListener("mouseenter", function () {
            if (!isIntroPlayerVisible) {
              musicPlayer.style.opacity = "1";
              musicPlayer.style.transform = "translateX(0)";
              musicPlayer.style.pointerEvents = "auto";
            }
          });

          musicPlayer.addEventListener("mouseenter", function () {
            clearTimeout(window.introHideTimeout);
          });

          musicIcon.addEventListener("mouseleave", function () {
            if (!isIntroPlayerVisible) {
              window.introHideTimeout = setTimeout(() => {
                if (!musicPlayer.matches(":hover")) {
                  musicPlayer.style.opacity = "0";
                  musicPlayer.style.transform = "translateX(-20px)";
                  musicPlayer.style.pointerEvents = "none";
                }
              }, 100);
            }
          });

          musicPlayer.addEventListener("mouseleave", function () {
            if (!isIntroPlayerVisible) {
              window.introHideTimeout = setTimeout(() => {
                if (!musicIcon.matches(":hover")) {
                  musicPlayer.style.opacity = "0";
                  musicPlayer.style.transform = "translateX(-20px)";
                  musicPlayer.style.pointerEvents = "none";
                }
              }, 100);
            }
          });
        }

        // ìŒì•… ë°ì´í„° ë¡œë“œ
        async function loadIntroMusic() {
          try {
            console.log("ìŒì•… ë°ì´í„° ë¡œë“œ ì‹œì‘");
            const { data: mainMemories, error: memoriesError } =
              await window.supabaseClient
                .from("memories")
                .select("id, created_at")
                .eq("tags", "#MAIN_BGM_ONLY")
                .order("created_at", { ascending: false });

            if (memoriesError) {
              console.error("BGM ì¡°íšŒ ì˜¤ë¥˜:", memoriesError);
              return;
            }

            if (!mainMemories || mainMemories.length === 0) {
              console.log("BGM ë°ì´í„° ì—†ìŒ");
              return;
            }

            console.log("BGM memories ë°œê²¬:", mainMemories.length);

            const playlistData = [];
            for (const memory of mainMemories) {
              const { data: musicData, error } = await window.supabaseClient
                .from("memory_music")
                .select("*")
                .eq("memory_id", memory.id);

              if (!error && musicData && musicData.length > 0) {
                playlistData.push(...musicData);
              }
            }

            if (playlistData.length === 0) {
              console.log("ìŒì•… ë°ì´í„° ì—†ìŒ");
              return;
            }

            introPlaylist = playlistData;
            console.log("í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì™„ë£Œ:", playlistData.length, "ê³¡");
            loadTrackByIndex(0);
          } catch (error) {
            console.error("ìŒì•… ë¡œë“œ ì‹¤íŒ¨:", error);
          }
        }

        // íŠ¹ì • íŠ¸ë™ ë¡œë“œ
        function loadTrackByIndex(index) {
          if (index < 0 || index >= introPlaylist.length) return;

          introCurrentTrackIndex = index;
          const musicData = introPlaylist[index];

          // ìŒì•… URL ìƒì„±
          let musicUrl = null;
          if (musicData.music_path) {
            const { data: musicUrlData } = window.supabaseClient.storage
              .from("media")
              .getPublicUrl(musicData.music_path);
            musicUrl = musicUrlData?.publicUrl;
          }

          // ì•¨ë²” ì»¤ë²„ URL ìƒì„±
          let albumUrl = null;
          if (musicData.album_path) {
            const { data: albumUrlData } = window.supabaseClient.storage
              .from("media")
              .getPublicUrl(musicData.album_path);
            albumUrl = albumUrlData?.publicUrl;
          }

          if (!musicUrl) return;

          // UI ì—…ë°ì´íŠ¸
          document.getElementById("intro-track-name").textContent =
            musicData.music_title || "ì•Œ ìˆ˜ ì—†ëŠ” ì œëª©";
          document.getElementById("intro-artist-name").textContent =
            musicData.artist_name || "ì•Œ ìˆ˜ ì—†ëŠ” ê°€ìˆ˜";
          document.getElementById("intro-album-img").src =
            albumUrl || DEFAULT_ALBUM_COVER_URL;

          // ì˜¤ë””ì˜¤ ì„¤ì •
          console.log("ìŒì•… URL ì„¤ì •:", musicUrl);
          introAudio.src = musicUrl;
          introAudio.load();

          // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ 1ê³¡ë§Œ ìˆìœ¼ë©´ ë£¨í”„ ì„¤ì •
          if (introPlaylist.length === 1) {
            introAudio.loop = true;
          } else {
            introAudio.loop = false;
          }

          // ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
          introAudio.onloadeddata = () => {
            console.log("ìŒì•… ë¡œë“œ ì™„ë£Œ, ì¬ìƒ ê°€ëŠ¥");
          };
        }

        // ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€
        function togglePlay() {
          const playBtn = document.getElementById("intro-play-btn");
          const icon = playBtn.querySelector("i");

          if (!introAudio.src) {
            console.log("ìŒì•… ì†ŒìŠ¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
            return;
          }

          if (introAudio.paused) {
            introAudio
              .play()
              .then(() => {
                icon.className = "fas fa-pause";
                console.log("ìŒì•… ì¬ìƒ ì‹œì‘");
              })
              .catch((error) => {
                console.error("ì¬ìƒ ì‹¤íŒ¨:", error);
              });
          } else {
            introAudio.pause();
            icon.className = "fas fa-play";
            console.log("ìŒì•… ì¼ì‹œì •ì§€");
          }
        }

        // ì´ì „ ê³¡
        function playPrevTrack() {
          const prevIndex =
            introCurrentTrackIndex > 0
              ? introCurrentTrackIndex - 1
              : introPlaylist.length - 1;
          loadTrackByIndex(prevIndex);
          if (!introAudio.paused) {
            introAudio.play();
          }
        }

        // ë‹¤ìŒ ê³¡
        function playNextTrack() {
          const nextIndex =
            introCurrentTrackIndex < introPlaylist.length - 1
              ? introCurrentTrackIndex + 1
              : 0;
          loadTrackByIndex(nextIndex);
          introAudio
            .play()
            .then(() => {
              document
                .getElementById("intro-play-btn")
                .querySelector("i").className = "fas fa-pause";
            })
            .catch(console.log);
        }

        // ì‹œí¬ë°” ì—…ë°ì´íŠ¸
        function updateSeekBar() {
          if (introAudio.duration) {
            const percent =
              (introAudio.currentTime / introAudio.duration) * 100;
            document.getElementById("intro-seek-bar").style.width =
              percent + "%";
          }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        initIntroMusicPlayer();

        // ëª¨ë°”ì¼ì—ì„œ button-containerë¥¼ text-section ì•ˆì˜ ê°€ì¥ ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë™
        function rearrangeButtonsForMobile() {
          const buttonContainer = document.querySelector(".button-container");
          const textSection = document.querySelector(".text-section");
          const cardContainer = document.querySelector(".card-container");

          if (buttonContainer && textSection && cardContainer) {
            if (window.innerWidth <= 768) {
              // ëª¨ë°”ì¼: text-sectionì˜ ê°€ì¥ ë§ˆì§€ë§‰ì— button-container ì¶”ê°€
              textSection.appendChild(buttonContainer);
            } else {
              // PC: ì›ë˜ ìœ„ì¹˜(card-containerì˜ ë§ˆì§€ë§‰)ë¡œ ë³µì›
              cardContainer.appendChild(buttonContainer);
            }
          }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        rearrangeButtonsForMobile();

        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œì—ë„ ì‹¤í–‰
        window.addEventListener("resize", rearrangeButtonsForMobile);

        // ì‚¬ìš©ì ì²« ìƒí˜¸ì‘ìš© ì‹œ ìë™ì¬ìƒ
        let hasUserInteracted = false;
        function startMusicOnFirstInteraction() {
          if (
            !hasUserInteracted &&
            introAudio &&
            introAudio.src &&
            introAudio.paused
          ) {
            hasUserInteracted = true;
            introAudio
              .play()
              .then(() => {
                document
                  .getElementById("intro-play-btn")
                  .querySelector("i").className = "fas fa-pause";
                console.log("ğŸµ ìŒì•… ìë™ ì¬ìƒ ì‹œì‘");
              })
              .catch((error) => {
                console.log("ğŸ”‡ ìë™ ì¬ìƒ ì‹¤íŒ¨:", error.name);
              });

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            document.removeEventListener("click", startMusicOnFirstInteraction);
            document.removeEventListener(
              "touchstart",
              startMusicOnFirstInteraction
            );
          }
        }

        // í´ë¦­ ë˜ëŠ” í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.addEventListener("click", startMusicOnFirstInteraction);
        document.addEventListener("touchstart", startMusicOnFirstInteraction);

        // 3ì´ˆ í›„ ì•ˆë‚´ ë©”ì‹œì§€ (ì„ íƒì‚¬í•­)
        setTimeout(() => {
          if (!hasUserInteracted && introAudio && introAudio.src) {
            console.log("ğŸ’¡ í™”ë©´ì„ í´ë¦­í•˜ë©´ ë°°ê²½ìŒì•…ì´ ì¬ìƒë©ë‹ˆë‹¤");
          }
        }, 3000);
      });
    </script>
  </body>
</html>
